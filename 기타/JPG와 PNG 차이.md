## 들어가기 전

```
Q. JPG와 PNG의 차이를 설명해 주세요
A. png는 배경색을 투명하게 저장할 수 있고, jpg는 불가능합니다!
```

실제 면접장이라고 생각하면,, 대답이 너무 디자이너스럽죠..?

그래서 오늘은 이걸 조금 더 개발자스럽게 대답해 볼 수 있도록 학습을 해보겠습니다!

# 압축 방식

지번주 [학습공유](https://github.com/alsongDalsong/CS-Study/blob/main/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4%20%EA%B3%B5%ED%95%99/iOS%EB%A9%94%EB%AA%A8%EB%A6%AC.md)에서 이미지와 관련된 내용이 기억나실까요?

그때 제가 이미지 파일 크기와 무관하게 실제로 압축을 해제하면 상당히 많은 양의 메모리를 차지한다고 말씀을 드렸는데요!

오늘은 역으로 압축을 어떻게 하길래 파일 크기가 그렇게 줄어드는 건지에 관한 내용을 알아보겠습니다.

## JPG 압축 방식 = 손실 압축

디지털 기기에서 컬러를 표현할 때는 RGB를 사용하는데 JPG는 이미지의 **일부 정보를 제거**해서 저장합니다.

이렇게 설명하면 감이 잘 안 오시죠?

더 쉽게 얘기하면,,

이렇게 색상을 추출해서 하나의 색으로 뭉개버리는 것입니다.

| 전 | 후 |
| -- | -- |
| ![2](https://github.com/user-attachments/assets/ada91713-9395-4615-a162-928796248d9a) | ![3](https://github.com/user-attachments/assets/5324e3bb-4e2b-4c01-8d36-d9645a41a4c7) |

### 손실 압축이 동작하는 방식

![다운로드](https://github.com/user-attachments/assets/1edbdc16-01b3-4cf1-ace7-0a03fc3b43e6)


그럼 그 과정을 차근차근 살펴보겠습니다.

**1. RGB to YCrCb**

가장 먼저 R,G,B형식을 Y, Cb, Cr 형식으로 변환합니다.

(Y: 밝기 / Cb: 초록색에서 파란색이 얼마나 섞였는지 / Cr: 초록색에서 빨간색이 얼마나 섞였는지)

그러면 이런 사자 이미지를 다음과 같이 나눌 수 있게 됩니다.

![4](https://github.com/user-attachments/assets/2bcaeced-a93b-4111-9b5c-5d44ad8e5182)

| Y | Cb | Cr |
| -- | -- | -- |
| ![y](https://github.com/user-attachments/assets/2843984e-8dbf-423c-8251-60c5834e8986) | ![cb](https://github.com/user-attachments/assets/2f1ba5f3-aab8-4ae2-9917-b273f746ff1e) | ![cr](https://github.com/user-attachments/assets/ac1ab0a3-d078-4edb-b3fd-11b3a86a8ace) |

**2. Down sampling**

그리고 Cb와 Cr에 아까 얘기했던 뭉개는 작업(다운샘플링)이 시작됩니다.

다운 샘플링은 J:a:b 비율로 제거하게 됩니다. 

![다운샘플링](https://github.com/user-attachments/assets/63f88c46-54f6-4070-88c2-48f5e4fad0b3)


여기서 J는 수평 방향 픽셀 수로 보편적으로 4가 가장 많이 사용됩니다.

a는 J픽셀 중에서 Cb,Cr 값을 공유하는 픽셀 수고, b는 두 번째 줄에서 Cb,Cr 값을 공유하는 픽셀 수입니다.

JPG는 4:2:0으로 정해져 있기 때문에 처음에 보신 사진처럼 나누게 되는 것입니다.

→ 4:2:0이니깐 수평, 수직을 모두 절반씩 감소하게 됩니다.

그럼 최종적으로 사자 이미지 사이즈가 1000이라고 했을 때 원래는 3MB가 필요했지만

이제는 1.5MB만 필요하게 됩니다.

(Y: 1000 * 1000 * 1byes, Cb: 1000 * 1000 * 1/4bytes, Cr: 1000 * 1000 * 1/4bytes)

이때 밝기 정보를 그대로 두는 이유는 사람의 시각 정보 인식 방식에 근거합니다!

사람의 시신경은 색의 정도보다 밝기를 더 중요하게 판단하기 때문에 Y 는 그대로 두고 Cb,Cr만 줄이게 됩니다.

**3. DCT Transform and Quantization (이진코사인변환)**

이 과정은 쉽게 설명하면 주파수(변화의 정도) 성분으로 변환하는 과정입니다.

- 저주파는 낮은 변화라고 생각하면 됩니다.
- 반대로 고주파는 높은 변화입니다.

아래와 같은 사진이 있을 때 나뭇잎들의 인접 픽셀은 저주파고, 나뭇잎과 하늘 간의 인접 픽셀은 고주파를 가지게 되는 것이죠.

![tree](https://github.com/user-attachments/assets/c088ba00-d913-465d-a517-a9ebafe81e03)


고주파 성분을 줄이면 사람의 눈은 거의 차이를 느끼지 못하기 때문에 고주파를 줄여서 용량을 줄이는 방식입니다.

그럼 DCT로 어떻게 변환하는지 살펴보겠습니다.

똑똑한 사람들이 64개의 패턴표를 만들어둔 게 있는데 그게 8*8로 되어있습니다.

![8*8](https://github.com/user-attachments/assets/3d8944c1-d283-4059-b7ca-cd32997f85c9)

그래서 이미지에 8*8 크기의 작은 블럭 단위로 분할한 다음에 해당 블럭이 패턴을 몇 개를 써야 재현할 수 있는지를 기록하게 됩니다.

![5](https://github.com/user-attachments/assets/4dfffe99-2806-4e46-baa9-c19fea5c5d92)


이렇게 DCT를 수행하면 좌측 상단에는 저주파가 배치되고 우측 하단에는 고주파가 배치되게 됩니다.

![7](https://github.com/user-attachments/assets/3e274569-16f7-4946-a7d5-d56198352e0b)

![6](https://github.com/user-attachments/assets/233a40dc-a2ee-4681-9bf0-16fdbf98a716)


**4. 양자화**

이제 고주파 성분을 제거해야겠죠? 

여기서도 똑똑하신 분들이 이미 만들어둔 양자화 행렬이 등장합니다..

이 행렬을 사용해서 각 계수를 나누면 낮은 주파수에서는 좋은 정밀도를 유지하고, 높은 주파수에는 효과적으로 정보를 줄일 수 있다고 합니다..

![행렬](https://github.com/user-attachments/assets/b96aa3ff-5e7f-4ec1-a7ea-f12264092443)

**5. 지그재그 스캐닝**

2차원 배열에 담겨있는 주파수 계수를 지그재그로 읽습니다.

![지그재그](https://github.com/user-attachments/assets/94de830b-5656-4159-b163-9599472e5f75)

왜냐면 고주파를 한 번에 모아서 곱셈기호를 사용해서 압축하면 효율이 더 좋겠죠?

쉽게 설명하면 0을 많이 모으려고 지그재그로 움직입니다.

![9](https://github.com/user-attachments/assets/e1909549-6aed-44ce-aad9-e7c29b27e4c3)

**6. 허프만 코딩**

허프만 코딩은 데이터를 압축하는 알고리즘 중 하나입니다.

원리를 설명하자면,, 

빈도가 높을수록(자주 등장할 수록) 짧은 코드를 부여하고, 드물게 등장하면 긴 코드를 할당해서 전체 데이터의 크기를 줄이는 것이 핵심입니다.

## PNG 압축 방식 = 비손실 압축(무손실 압축)

PNG는 위에서 본 JPG와 다르게 비손실 압축의 대표적인 예시입니다.

LZ77 알고리즘이랑 허프만 코딩의 조합으로 이루어진다고 하는데,, 뭔지 살펴보겠습니다.

### 1. LZ77알고리즘

수식은 패스하고,, 뭐하는 알고리즘인지 살펴보겠습니다.

LZ77은 현재 압축하려는 데이터가 이전에 등장한 적이 있는지 파악해서 반복 여부를 표시하는 알고리즘입니다.

![lz77](https://github.com/user-attachments/assets/d299ec64-e076-4a27-b639-2f96406bba37)



## **2. 허프만 코딩**

그래서 위에서 봤던 허프만 코딩이 또 등장합니다.

자주 나오는 데이터는 짧게 저장하고, 거의 안 나오는 데이터는 길게 저장해서 전체 크기를 더 줄이는 것이죠!

자 이제 다시 면접장으로 돌아가서 얘기해봅시다.

```
Q. JPG와 PNG의 차이를 설명해주세요
A. 둘 다 이미지 파일 형식이지만 JPG는 손실 압축을 사용하고 PNG는 무손실 압축을 사용합니다. 따라서 파일 크기가 JPG가 상대적으로 작습니다.

꼬리질문Q. 손실압축은 무엇인가요?
A. 데이터를 압축할 때 일부 정보를 버려서 파일 크기를 줄이는 방식입니다. 대표적으로 JPG는 인간의 눈이 색상 차이보다 밝기 차이를 민감하다 받아드린다는 점을 이용해 색 정보를 줄이는 방식으로 압축합니다.

꼬리질문Q. 비손실압축은 무엇인가요?
A. 데이터 내 중복 패턴을 찾아 효율적으로 표현한 뒤, 이걸 인코딩해서 품질 저하 없이 데이터를 압축하는 방식입니다. 손실 압축보다 압축률이 낮아 파일 크기가 상대적으로 큽니다.
```
